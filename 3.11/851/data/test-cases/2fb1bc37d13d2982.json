{"uid":"2fb1bc37d13d2982","name":"Validate Council Output [TonbridgeAndMallingBC]","fullName":"features/validate_council_outputs.feature:Validate Council Output","historyId":"702154f20d1bb392cb26213b3a14a202","time":{"start":1691612200318,"stop":1691612212687,"duration":12369},"status":"failed","statusMessage":"AttributeError: 'NoneType' object has no attribute 'find'","statusTrace":"request = <FixtureRequest for <Function test_scenario_outline[TonbridgeAndMallingBC]>>\n_pytest_bdd_example = {'council': 'TonbridgeAndMallingBC'}\n\n    @pytest.mark.usefixtures(*func_args)\n    def scenario_wrapper(request: FixtureRequest, _pytest_bdd_example: dict[str, str]) -> Any:\n        scenario = templated_scenario.render(_pytest_bdd_example)\n>       _execute_scenario(feature, scenario, request)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/pytest_bdd/scenario.py:187: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/pytest_bdd/scenario.py:157: in _execute_scenario\n    _execute_step_function(request, scenario, step, step_func)\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/pytest_bdd/scenario.py:127: in _execute_step_function\n    return_value = call_fixture_func(fixturefunc=step_func, request=request, kwargs=kwargs)\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:902: in call_fixture_func\n    fixture_result = fixturefunc(**kwargs)\nuk_bin_collection/tests/step_defs/test_validate_council.py:62: in scrape_step\n    raise (err)\nuk_bin_collection/tests/step_defs/test_validate_council.py:58: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:71: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:59: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:70: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <TonbridgeAndMallingBC.CouncilClass object at 0x7f7cdeb8cb50>, page = ''\nkwargs = {'paon': None, 'postcode': 'ME19 4JS', 'uprn': '10002914589', 'usrn': None}\nuser_uprn = '10002914589', user_postcode = 'ME19 4JS'\nheaders = {'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8', 'Accept-Language': 'en-GB,en;q=0.6', 'Cache-Control': 'no-cache', 'Connection': 'keep-alive', ...}\ndata = {'bins': []}, response = <Response [500]>\nsoup = <!DOCTYPE html>\n\n<!--[if IE 9]>          <html class=\"lt-ie10 no-js\" lang=\"en\"> <![endif]-->\n<!--[if gt IE 9]><!--> <h...on;var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();</script>\n</body>\n</html>\n\nlast_date = datetime.datetime(2023, 8, 9, 20, 16, 52, 685165)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Get UPRN and postcode from the parsed args\n        user_uprn = kwargs.get(\"uprn\")\n        user_postcode = kwargs.get(\"postcode\")\n        check_uprn(user_uprn)\n        check_postcode(user_postcode)\n    \n        requests.packages.urllib3.disable_warnings()\n    \n        # Set up some form data, then POST for the form and scrape the result\n        headers = {\n            \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\",\n            \"Accept-Language\": \"en-GB,en;q=0.6\",\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"Content-Type\": \"multipart/form-data; boundary=----WebKitFormBoundaryI1XYcX9fNeKxm4LB\",\n            # 'Cookie': 'PHPSESSID=-3mn6j-vkWcY4xPPXbT3Ggk1gSQJLId%2CztSoQV5-f8Pi7Cju1wwE151qtwdUyE1c',\n            \"Origin\": \"https://www.tmbc.gov.uk\",\n            \"Pragma\": \"no-cache\",\n            \"Referer\": \"https://www.tmbc.gov.uk/xfp/form/167\",\n            \"Sec-Fetch-Dest\": \"document\",\n            \"Sec-Fetch-Mode\": \"navigate\",\n            \"Sec-Fetch-Site\": \"same-origin\",\n            \"Sec-Fetch-User\": \"?1\",\n            \"Sec-GPC\": \"1\",\n            \"Upgrade-Insecure-Requests\": \"1\",\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\",\n            \"sec-ch-ua\": '\"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"108\", \"Brave\";v=\"108\"',\n            \"sec-ch-ua-mobile\": \"?0\",\n            \"sec-ch-ua-platform\": '\"Windows\"',\n        }\n        data = (\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"__token\"\\r\\n\\r\\ns_flSv1eIvJDeCwbFaYxclM3UTomdpWgg2cMWzZckaU\\r\\n'\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"page\"\\r\\n\\r\\n128\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: '\n            f'form-data; name=\"locale\"\\r\\n\\r\\nen_GB\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent'\n            f'-Disposition: form-data; name=\"q752eec300b2ffef2757e4536b77b07061842041a_0_0\"\\r\\n\\r\\n'\n            f\"{user_postcode}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"q752eec300b2ffef2757e4536b77b07061842041a_1_0\"\\r\\n\\r\\n'\n            f\"{user_uprn}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"next\"\\r\\n\\r\\nNext\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB--\\r\\n '\n        )\n    \n        response = requests.post(\n            \"https://www.tmbc.gov.uk/xfp/form/167\", headers=headers, data=data\n        )\n        soup = BeautifulSoup(response.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        last_date = datetime.now()\n    \n        # Find the table on the page and get data from each row (we don't care about the headings)\n        table = soup.find(\n            \"table\", {\"class\": \"data-table waste-collections-table\"}\n>       ).find(\"tbody\")\nE       AttributeError: 'NoneType' object has no attribute 'find'\n\nuk_bin_collection/uk_bin_collection/councils/TonbridgeAndMallingBC.py:74: AttributeError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"failed","statusMessage":"AttributeError: 'NoneType' object has no attribute 'find'","statusTrace":"request = <FixtureRequest for <Function test_scenario_outline[TonbridgeAndMallingBC]>>\n_pytest_bdd_example = {'council': 'TonbridgeAndMallingBC'}\n\n    @pytest.mark.usefixtures(*func_args)\n    def scenario_wrapper(request: FixtureRequest, _pytest_bdd_example: dict[str, str]) -> Any:\n        scenario = templated_scenario.render(_pytest_bdd_example)\n>       _execute_scenario(feature, scenario, request)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/pytest_bdd/scenario.py:187: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/pytest_bdd/scenario.py:157: in _execute_scenario\n    _execute_step_function(request, scenario, step, step_func)\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/pytest_bdd/scenario.py:127: in _execute_step_function\n    return_value = call_fixture_func(fixturefunc=step_func, request=request, kwargs=kwargs)\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:902: in call_fixture_func\n    fixture_result = fixturefunc(**kwargs)\nuk_bin_collection/tests/step_defs/test_validate_council.py:62: in scrape_step\n    raise (err)\nuk_bin_collection/tests/step_defs/test_validate_council.py:58: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:71: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:59: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:70: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <TonbridgeAndMallingBC.CouncilClass object at 0x7f7cdeb8cb50>, page = ''\nkwargs = {'paon': None, 'postcode': 'ME19 4JS', 'uprn': '10002914589', 'usrn': None}\nuser_uprn = '10002914589', user_postcode = 'ME19 4JS'\nheaders = {'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8', 'Accept-Language': 'en-GB,en;q=0.6', 'Cache-Control': 'no-cache', 'Connection': 'keep-alive', ...}\ndata = {'bins': []}, response = <Response [500]>\nsoup = <!DOCTYPE html>\n\n<!--[if IE 9]>          <html class=\"lt-ie10 no-js\" lang=\"en\"> <![endif]-->\n<!--[if gt IE 9]><!--> <h...on;var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();</script>\n</body>\n</html>\n\nlast_date = datetime.datetime(2023, 8, 9, 20, 16, 52, 685165)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Get UPRN and postcode from the parsed args\n        user_uprn = kwargs.get(\"uprn\")\n        user_postcode = kwargs.get(\"postcode\")\n        check_uprn(user_uprn)\n        check_postcode(user_postcode)\n    \n        requests.packages.urllib3.disable_warnings()\n    \n        # Set up some form data, then POST for the form and scrape the result\n        headers = {\n            \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\",\n            \"Accept-Language\": \"en-GB,en;q=0.6\",\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"Content-Type\": \"multipart/form-data; boundary=----WebKitFormBoundaryI1XYcX9fNeKxm4LB\",\n            # 'Cookie': 'PHPSESSID=-3mn6j-vkWcY4xPPXbT3Ggk1gSQJLId%2CztSoQV5-f8Pi7Cju1wwE151qtwdUyE1c',\n            \"Origin\": \"https://www.tmbc.gov.uk\",\n            \"Pragma\": \"no-cache\",\n            \"Referer\": \"https://www.tmbc.gov.uk/xfp/form/167\",\n            \"Sec-Fetch-Dest\": \"document\",\n            \"Sec-Fetch-Mode\": \"navigate\",\n            \"Sec-Fetch-Site\": \"same-origin\",\n            \"Sec-Fetch-User\": \"?1\",\n            \"Sec-GPC\": \"1\",\n            \"Upgrade-Insecure-Requests\": \"1\",\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\",\n            \"sec-ch-ua\": '\"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"108\", \"Brave\";v=\"108\"',\n            \"sec-ch-ua-mobile\": \"?0\",\n            \"sec-ch-ua-platform\": '\"Windows\"',\n        }\n        data = (\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"__token\"\\r\\n\\r\\ns_flSv1eIvJDeCwbFaYxclM3UTomdpWgg2cMWzZckaU\\r\\n'\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"page\"\\r\\n\\r\\n128\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: '\n            f'form-data; name=\"locale\"\\r\\n\\r\\nen_GB\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent'\n            f'-Disposition: form-data; name=\"q752eec300b2ffef2757e4536b77b07061842041a_0_0\"\\r\\n\\r\\n'\n            f\"{user_postcode}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"q752eec300b2ffef2757e4536b77b07061842041a_1_0\"\\r\\n\\r\\n'\n            f\"{user_uprn}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"next\"\\r\\n\\r\\nNext\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB--\\r\\n '\n        )\n    \n        response = requests.post(\n            \"https://www.tmbc.gov.uk/xfp/form/167\", headers=headers, data=data\n        )\n        soup = BeautifulSoup(response.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        last_date = datetime.now()\n    \n        # Find the table on the page and get data from each row (we don't care about the headings)\n        table = soup.find(\n            \"table\", {\"class\": \"data-table waste-collections-table\"}\n>       ).find(\"tbody\")\nE       AttributeError: 'NoneType' object has no attribute 'find'\n\nuk_bin_collection/uk_bin_collection/councils/TonbridgeAndMallingBC.py:74: AttributeError","steps":[{"name":"Given the council: TonbridgeAndMallingBC","time":{"start":1691612200319,"stop":1691612200319,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false,"hasContent":false},{"name":"When we scrape the data from TonbridgeAndMallingBC","time":{"start":1691612200319,"stop":1691612212687,"duration":12368},"status":"failed","statusMessage":"'NoneType' object has no attribute 'find'","statusTrace":"AttributeError: 'NoneType' object has no attribute 'find'\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":true,"hasContent":true}],"attachments":[],"parameters":[],"stepsCount":2,"attachmentsCount":0,"shouldDisplayMessage":true,"hasContent":true},"afterStages":[],"labels":[{"name":"host","value":"fv-az262-213"},{"name":"thread","value":"2108-MainThread"},{"name":"framework","value":"pytest-bdd"},{"name":"language","value":"cpython3"},{"name":"feature","value":"Test each council output matches expected results in /outputs"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"council","value":"TonbridgeAndMallingBC"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":3,"broken":0,"skipped":0,"passed":27,"unknown":0,"total":30},"items":[{"uid":"6cd9387a187339bb","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/847//#testresult/6cd9387a187339bb","status":"passed","time":{"start":1691544554030,"stop":1691544556715,"duration":2685}},{"uid":"1f18b5a15259469e","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/846//#testresult/1f18b5a15259469e","status":"passed","time":{"start":1691457934419,"stop":1691457936908,"duration":2489}},{"uid":"4a8158f0d78f69c0","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/845//#testresult/4a8158f0d78f69c0","status":"passed","time":{"start":1691371851500,"stop":1691371854561,"duration":3061}},{"uid":"a84f6c17041fe472","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/844//#testresult/a84f6c17041fe472","status":"passed","time":{"start":1691285022756,"stop":1691285025875,"duration":3119}},{"uid":"95752836a5a2caa8","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/843//#testresult/95752836a5a2caa8","status":"passed","time":{"start":1691198715418,"stop":1691198717881,"duration":2463}},{"uid":"d86eb906e07d5fb8","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/842//#testresult/d86eb906e07d5fb8","status":"passed","time":{"start":1691112501081,"stop":1691112503702,"duration":2621}},{"uid":"3ab762d64d10db5","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/841//#testresult/3ab762d64d10db5","status":"passed","time":{"start":1691026144546,"stop":1691026147505,"duration":2959}},{"uid":"fbc23552ba93f10a","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/840//#testresult/fbc23552ba93f10a","status":"passed","time":{"start":1690939506422,"stop":1690939509117,"duration":2695}},{"uid":"31849823cdaf6642","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/839//#testresult/31849823cdaf6642","status":"passed","time":{"start":1690854273088,"stop":1690854275511,"duration":2423}},{"uid":"aefb2a29cc34c069","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/838//#testresult/aefb2a29cc34c069","status":"passed","time":{"start":1690767107632,"stop":1690767110208,"duration":2576}},{"uid":"52b1e91ab2922561","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/837//#testresult/52b1e91ab2922561","status":"passed","time":{"start":1690680755043,"stop":1690680757991,"duration":2948}},{"uid":"7ca1b0260cb14e8","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/836//#testresult/7ca1b0260cb14e8","status":"passed","time":{"start":1690594065391,"stop":1690594068099,"duration":2708}},{"uid":"b8d400c731461731","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/835//#testresult/b8d400c731461731","status":"passed","time":{"start":1690563548335,"stop":1690563551085,"duration":2750}},{"uid":"d9c7e366554c7ccf","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/833//#testresult/d9c7e366554c7ccf","status":"passed","time":{"start":1690562947527,"stop":1690562950681,"duration":3154}},{"uid":"fa27177cb158e90d","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/832//#testresult/fa27177cb158e90d","status":"passed","time":{"start":1690507573246,"stop":1690507576526,"duration":3280}},{"uid":"f48f29bdcf6a3f10","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/831//#testresult/f48f29bdcf6a3f10","status":"passed","time":{"start":1690421110744,"stop":1690421113489,"duration":2745}},{"uid":"fdcf6b5e391e5ddd","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/830//#testresult/fdcf6b5e391e5ddd","status":"passed","time":{"start":1690335696093,"stop":1690335698722,"duration":2629}},{"uid":"9dfb5c648e14dd79","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/829//#testresult/9dfb5c648e14dd79","status":"passed","time":{"start":1690249822302,"stop":1690249824676,"duration":2374}},{"uid":"e6d1b68c12255e68","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/828//#testresult/e6d1b68c12255e68","status":"passed","time":{"start":1690162854820,"stop":1690162858072,"duration":3252}},{"uid":"dd989826f017f249","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.11/827//#testresult/dd989826f017f249","status":"passed","time":{"start":1690123557694,"stop":1690123560775,"duration":3081}}]},"tags":[]},"source":"2fb1bc37d13d2982.json","parameterValues":["TonbridgeAndMallingBC"]}