{"uid":"35e7ec9ef90fdfcb","name":"Validate Council Output [TonbridgeAndMallingBC]","fullName":"features/validate_council_outputs.feature:Validate Council Output","historyId":"702154f20d1bb392cb26213b3a14a202","time":{"start":1691612154159,"stop":1691612165906,"duration":11747},"status":"failed","statusMessage":"AttributeError: 'NoneType' object has no attribute 'find'","statusTrace":"request = <FixtureRequest for <Function test_scenario_outline[TonbridgeAndMallingBC]>>\n_pytest_bdd_example = {'council': 'TonbridgeAndMallingBC'}\n\n    @pytest.mark.usefixtures(*func_args)\n    def scenario_wrapper(request: FixtureRequest, _pytest_bdd_example: dict[str, str]) -> Any:\n        scenario = templated_scenario.render(_pytest_bdd_example)\n>       _execute_scenario(feature, scenario, request)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/pytest_bdd/scenario.py:187: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/pytest_bdd/scenario.py:157: in _execute_scenario\n    _execute_step_function(request, scenario, step, step_func)\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/pytest_bdd/scenario.py:127: in _execute_step_function\n    return_value = call_fixture_func(fixturefunc=step_func, request=request, kwargs=kwargs)\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/_pytest/fixtures.py:902: in call_fixture_func\n    fixture_result = fixturefunc(**kwargs)\nuk_bin_collection/tests/step_defs/test_validate_council.py:62: in scrape_step\n    raise (err)\nuk_bin_collection/tests/step_defs/test_validate_council.py:58: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:71: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:59: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:70: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <TonbridgeAndMallingBC.CouncilClass object at 0x7f9022b8d5d0>, page = ''\nkwargs = {'paon': None, 'postcode': 'ME19 4JS', 'uprn': '10002914589', 'usrn': None}\nuser_uprn = '10002914589', user_postcode = 'ME19 4JS'\nheaders = {'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8', 'Accept-Language': 'en-GB,en;q=0.6', 'Cache-Control': 'no-cache', 'Connection': 'keep-alive', ...}\ndata = {'bins': []}, response = <Response [500]>\nsoup = <!DOCTYPE html>\n\n<!--[if IE 9]>          <html class=\"lt-ie10 no-js\" lang=\"en\"> <![endif]-->\n<!--[if gt IE 9]><!--> <h...on;var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();</script>\n</body>\n</html>\n\nlast_date = datetime.datetime(2023, 8, 9, 20, 16, 5, 904515)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Get UPRN and postcode from the parsed args\n        user_uprn = kwargs.get(\"uprn\")\n        user_postcode = kwargs.get(\"postcode\")\n        check_uprn(user_uprn)\n        check_postcode(user_postcode)\n    \n        requests.packages.urllib3.disable_warnings()\n    \n        # Set up some form data, then POST for the form and scrape the result\n        headers = {\n            \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\",\n            \"Accept-Language\": \"en-GB,en;q=0.6\",\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"Content-Type\": \"multipart/form-data; boundary=----WebKitFormBoundaryI1XYcX9fNeKxm4LB\",\n            # 'Cookie': 'PHPSESSID=-3mn6j-vkWcY4xPPXbT3Ggk1gSQJLId%2CztSoQV5-f8Pi7Cju1wwE151qtwdUyE1c',\n            \"Origin\": \"https://www.tmbc.gov.uk\",\n            \"Pragma\": \"no-cache\",\n            \"Referer\": \"https://www.tmbc.gov.uk/xfp/form/167\",\n            \"Sec-Fetch-Dest\": \"document\",\n            \"Sec-Fetch-Mode\": \"navigate\",\n            \"Sec-Fetch-Site\": \"same-origin\",\n            \"Sec-Fetch-User\": \"?1\",\n            \"Sec-GPC\": \"1\",\n            \"Upgrade-Insecure-Requests\": \"1\",\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\",\n            \"sec-ch-ua\": '\"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"108\", \"Brave\";v=\"108\"',\n            \"sec-ch-ua-mobile\": \"?0\",\n            \"sec-ch-ua-platform\": '\"Windows\"',\n        }\n        data = (\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"__token\"\\r\\n\\r\\ns_flSv1eIvJDeCwbFaYxclM3UTomdpWgg2cMWzZckaU\\r\\n'\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"page\"\\r\\n\\r\\n128\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: '\n            f'form-data; name=\"locale\"\\r\\n\\r\\nen_GB\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent'\n            f'-Disposition: form-data; name=\"q752eec300b2ffef2757e4536b77b07061842041a_0_0\"\\r\\n\\r\\n'\n            f\"{user_postcode}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"q752eec300b2ffef2757e4536b77b07061842041a_1_0\"\\r\\n\\r\\n'\n            f\"{user_uprn}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"next\"\\r\\n\\r\\nNext\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB--\\r\\n '\n        )\n    \n        response = requests.post(\n            \"https://www.tmbc.gov.uk/xfp/form/167\", headers=headers, data=data\n        )\n        soup = BeautifulSoup(response.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        last_date = datetime.now()\n    \n        # Find the table on the page and get data from each row (we don't care about the headings)\n        table = soup.find(\n            \"table\", {\"class\": \"data-table waste-collections-table\"}\n>       ).find(\"tbody\")\nE       AttributeError: 'NoneType' object has no attribute 'find'\n\nuk_bin_collection/uk_bin_collection/councils/TonbridgeAndMallingBC.py:74: AttributeError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"failed","statusMessage":"AttributeError: 'NoneType' object has no attribute 'find'","statusTrace":"request = <FixtureRequest for <Function test_scenario_outline[TonbridgeAndMallingBC]>>\n_pytest_bdd_example = {'council': 'TonbridgeAndMallingBC'}\n\n    @pytest.mark.usefixtures(*func_args)\n    def scenario_wrapper(request: FixtureRequest, _pytest_bdd_example: dict[str, str]) -> Any:\n        scenario = templated_scenario.render(_pytest_bdd_example)\n>       _execute_scenario(feature, scenario, request)\n\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/pytest_bdd/scenario.py:187: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/pytest_bdd/scenario.py:157: in _execute_scenario\n    _execute_step_function(request, scenario, step, step_func)\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/pytest_bdd/scenario.py:127: in _execute_step_function\n    return_value = call_fixture_func(fixturefunc=step_func, request=request, kwargs=kwargs)\n../../../.cache/pypoetry/virtualenvs/uk-bin-collection-EwS6Gn8s-py3.10/lib/python3.10/site-packages/_pytest/fixtures.py:902: in call_fixture_func\n    fixture_result = fixturefunc(**kwargs)\nuk_bin_collection/tests/step_defs/test_validate_council.py:62: in scrape_step\n    raise (err)\nuk_bin_collection/tests/step_defs/test_validate_council.py:58: in scrape_step\n    context.parse_result = CollectData.run()\nuk_bin_collection/uk_bin_collection/collect_data.py:71: in run\n    return self.client_code(\nuk_bin_collection/uk_bin_collection/collect_data.py:59: in client_code\n    return get_bin_data_class.template_method(address_url, **kwargs)\nuk_bin_collection/uk_bin_collection/get_bin_data.py:70: in template_method\n    bin_data_dict = self.parse_data(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <TonbridgeAndMallingBC.CouncilClass object at 0x7f9022b8d5d0>, page = ''\nkwargs = {'paon': None, 'postcode': 'ME19 4JS', 'uprn': '10002914589', 'usrn': None}\nuser_uprn = '10002914589', user_postcode = 'ME19 4JS'\nheaders = {'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8', 'Accept-Language': 'en-GB,en;q=0.6', 'Cache-Control': 'no-cache', 'Connection': 'keep-alive', ...}\ndata = {'bins': []}, response = <Response [500]>\nsoup = <!DOCTYPE html>\n\n<!--[if IE 9]>          <html class=\"lt-ie10 no-js\" lang=\"en\"> <![endif]-->\n<!--[if gt IE 9]><!--> <h...on;var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();</script>\n</body>\n</html>\n\nlast_date = datetime.datetime(2023, 8, 9, 20, 16, 5, 904515)\n\n    def parse_data(self, page: str, **kwargs) -> dict:\n        # Get UPRN and postcode from the parsed args\n        user_uprn = kwargs.get(\"uprn\")\n        user_postcode = kwargs.get(\"postcode\")\n        check_uprn(user_uprn)\n        check_postcode(user_postcode)\n    \n        requests.packages.urllib3.disable_warnings()\n    \n        # Set up some form data, then POST for the form and scrape the result\n        headers = {\n            \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\",\n            \"Accept-Language\": \"en-GB,en;q=0.6\",\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"Content-Type\": \"multipart/form-data; boundary=----WebKitFormBoundaryI1XYcX9fNeKxm4LB\",\n            # 'Cookie': 'PHPSESSID=-3mn6j-vkWcY4xPPXbT3Ggk1gSQJLId%2CztSoQV5-f8Pi7Cju1wwE151qtwdUyE1c',\n            \"Origin\": \"https://www.tmbc.gov.uk\",\n            \"Pragma\": \"no-cache\",\n            \"Referer\": \"https://www.tmbc.gov.uk/xfp/form/167\",\n            \"Sec-Fetch-Dest\": \"document\",\n            \"Sec-Fetch-Mode\": \"navigate\",\n            \"Sec-Fetch-Site\": \"same-origin\",\n            \"Sec-Fetch-User\": \"?1\",\n            \"Sec-GPC\": \"1\",\n            \"Upgrade-Insecure-Requests\": \"1\",\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\",\n            \"sec-ch-ua\": '\"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"108\", \"Brave\";v=\"108\"',\n            \"sec-ch-ua-mobile\": \"?0\",\n            \"sec-ch-ua-platform\": '\"Windows\"',\n        }\n        data = (\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"__token\"\\r\\n\\r\\ns_flSv1eIvJDeCwbFaYxclM3UTomdpWgg2cMWzZckaU\\r\\n'\n            f\"------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"page\"\\r\\n\\r\\n128\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: '\n            f'form-data; name=\"locale\"\\r\\n\\r\\nen_GB\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent'\n            f'-Disposition: form-data; name=\"q752eec300b2ffef2757e4536b77b07061842041a_0_0\"\\r\\n\\r\\n'\n            f\"{user_postcode}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"q752eec300b2ffef2757e4536b77b07061842041a_1_0\"\\r\\n\\r\\n'\n            f\"{user_uprn}\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB\\r\\nContent-Disposition: form-data; \"\n            f'name=\"next\"\\r\\n\\r\\nNext\\r\\n------WebKitFormBoundaryI1XYcX9fNeKxm4LB--\\r\\n '\n        )\n    \n        response = requests.post(\n            \"https://www.tmbc.gov.uk/xfp/form/167\", headers=headers, data=data\n        )\n        soup = BeautifulSoup(response.text, features=\"html.parser\")\n        soup.prettify()\n    \n        data = {\"bins\": []}\n        last_date = datetime.now()\n    \n        # Find the table on the page and get data from each row (we don't care about the headings)\n        table = soup.find(\n            \"table\", {\"class\": \"data-table waste-collections-table\"}\n>       ).find(\"tbody\")\nE       AttributeError: 'NoneType' object has no attribute 'find'\n\nuk_bin_collection/uk_bin_collection/councils/TonbridgeAndMallingBC.py:74: AttributeError","steps":[{"name":"Given the council: TonbridgeAndMallingBC","time":{"start":1691612154159,"stop":1691612154160,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false,"hasContent":false},{"name":"When we scrape the data from TonbridgeAndMallingBC","time":{"start":1691612154160,"stop":1691612165906,"duration":11746},"status":"failed","statusMessage":"'NoneType' object has no attribute 'find'","statusTrace":"AttributeError: 'NoneType' object has no attribute 'find'\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":true,"hasContent":true}],"attachments":[],"parameters":[],"stepsCount":2,"attachmentsCount":0,"shouldDisplayMessage":true,"hasContent":true},"afterStages":[],"labels":[{"name":"host","value":"fv-az403-305"},{"name":"thread","value":"2117-MainThread"},{"name":"framework","value":"pytest-bdd"},{"name":"language","value":"cpython3"},{"name":"feature","value":"Test each council output matches expected results in /outputs"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"council","value":"TonbridgeAndMallingBC"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":3,"broken":0,"skipped":0,"passed":23,"unknown":0,"total":26},"items":[{"uid":"4d94d1aef0c496ba","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/847//#testresult/4d94d1aef0c496ba","status":"passed","time":{"start":1691544544840,"stop":1691544547689,"duration":2849}},{"uid":"bed017fded467088","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/846//#testresult/bed017fded467088","status":"passed","time":{"start":1691457935886,"stop":1691457938569,"duration":2683}},{"uid":"f836e8519a75b2b9","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/845//#testresult/f836e8519a75b2b9","status":"passed","time":{"start":1691371854591,"stop":1691371856947,"duration":2356}},{"uid":"47e7408d2c15c68c","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/844//#testresult/47e7408d2c15c68c","status":"passed","time":{"start":1691285014620,"stop":1691285017744,"duration":3124}},{"uid":"75097d020cab7cce","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/843//#testresult/75097d020cab7cce","status":"passed","time":{"start":1691198714323,"stop":1691198717068,"duration":2745}},{"uid":"e04438ae40410148","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/842//#testresult/e04438ae40410148","status":"passed","time":{"start":1691112516315,"stop":1691112519037,"duration":2722}},{"uid":"ed9a561474f4d374","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/841//#testresult/ed9a561474f4d374","status":"passed","time":{"start":1691026176322,"stop":1691026179269,"duration":2947}},{"uid":"8f8a6bc285614296","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/840//#testresult/8f8a6bc285614296","status":"passed","time":{"start":1690939533117,"stop":1690939536216,"duration":3099}},{"uid":"5800d2e18d325a8f","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/839//#testresult/5800d2e18d325a8f","status":"passed","time":{"start":1690854271429,"stop":1690854273881,"duration":2452}},{"uid":"f6314d5b57ebe760","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/838//#testresult/f6314d5b57ebe760","status":"passed","time":{"start":1690767080051,"stop":1690767082829,"duration":2778}},{"uid":"d3818d8b10e638c4","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/837//#testresult/d3818d8b10e638c4","status":"passed","time":{"start":1690680757223,"stop":1690680760165,"duration":2942}},{"uid":"9e246a1870b70e5a","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/836//#testresult/9e246a1870b70e5a","status":"passed","time":{"start":1690594007680,"stop":1690594010668,"duration":2988}},{"uid":"1f092ff952443e86","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/835//#testresult/1f092ff952443e86","status":"passed","time":{"start":1690563580642,"stop":1690563583629,"duration":2987}},{"uid":"c1ec4fad9a75b144","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/833//#testresult/c1ec4fad9a75b144","status":"passed","time":{"start":1690562931172,"stop":1690562933964,"duration":2792}},{"uid":"d6c07131ff487b62","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/832//#testresult/d6c07131ff487b62","status":"passed","time":{"start":1690507574423,"stop":1690507577346,"duration":2923}},{"uid":"d4eb370c297d0826","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/831//#testresult/d4eb370c297d0826","status":"passed","time":{"start":1690421129316,"stop":1690421132084,"duration":2768}},{"uid":"489f6b155a2e2b69","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/830//#testresult/489f6b155a2e2b69","status":"passed","time":{"start":1690335698906,"stop":1690335701160,"duration":2254}},{"uid":"ab8ba9e5a6defca7","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/829//#testresult/ab8ba9e5a6defca7","status":"passed","time":{"start":1690249818274,"stop":1690249820886,"duration":2612}},{"uid":"c217d5b0e0096f2b","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/828//#testresult/c217d5b0e0096f2b","status":"passed","time":{"start":1690162893803,"stop":1690162896758,"duration":2955}},{"uid":"d66b78124c69a768","reportUrl":"https://robbrad.github.io/UKBinCollectionData/3.10/827//#testresult/d66b78124c69a768","status":"passed","time":{"start":1690123530370,"stop":1690123532699,"duration":2329}}]},"tags":[]},"source":"35e7ec9ef90fdfcb.json","parameterValues":["TonbridgeAndMallingBC"]}